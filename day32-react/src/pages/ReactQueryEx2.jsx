// ReactQueryEx2.jsx

import { useQueries, useQuery, useQueryClient } from "@tanstack/react-query"
import axios from "axios";

// í˜„ì¬ ì˜ˆì œëŠ” ì—¬ëŸ¬ APIë¥¼ ë™ì‹œì— ê´€ë¦¬í•  ë•Œ 
// ê°ê°ì˜ APIë§ˆë‹¤ ë‹¤ë¥¸ queryKeyë¥¼ ì£¼ë©´ ì™„ë²½í•˜ê²Œ ë¶„ë¦¬í•´ì„œ
// ê¸°ì–µ(ìºì‹œ) í• ìˆ˜ìˆëŠ” ì˜ˆì œ!
// í•œ ì‡¼í•‘ëª°ì—ì„œ user,product,commnets ëŒ“ê¸€ 

// ìƒˆë¡œê³ ì¹¨ 
//  - ì£¼ê¸°ì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ í•œ ë‚´ìš©ë“¤ì„ ê°€ì ¸ì˜¬ ìˆ˜ìˆë‹¤. 



export default function ReactQueryEx2() {

    // 1. ë¨¼ì € ê´€ë¦¬í•˜ëŠ” useQueryë“¤ì„ ë§Œë“ ë‹¤.

    // ì‚¬ìš©ìì— ëŒ€í•œ ì •ë³´
    const {data : users ,
      isLoading : userIsLoading,
        isError : userIsError
    } = useQuery({
        queryKey : ["users"],
        queryFn :  () => axios
                            .get("https://dummyjson.com/users?limit=5")
                            .then((res) => res.data.users)
        
    });
    // ë¬¼ê±´ì— ëŒ€í•œ ì •ë³´
    const {data : products ,
      isLoading : productsIsLoading, 
        isError : productsIsError
    } = useQuery({
        queryKey : ["products"],
        queryFn: () => axios
                      .get("https://dummyjson.com/products?limit=5").then((res) => res.data.products),

    });
    // ëŒ“ê¸€ëª©ë¡ 
    const {data : comments,
       isLoading: commentsIsLoding,
        isError : commentsIsError
    } = useQuery({
        queryKey : ["comments"],
        queryFn: () => axios
                      .get("https://dummyjson.com/comments?limit=5").then((res) => res.data.comments),
    })

    // êµ¬ì¡° ë¶„í•´ëŠ” ë°°ì—´ì´ë‚˜ ê°ì²´ ì•ˆì˜ ê°’ì„ êº¼ë‚´ì„œ ë³€ìˆ˜ë¡œ ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ìˆëŠ”
    // ë¬¸ë²• 
    const results = useQueries({
        queries : [
            {queryKey : ["users"]},
            {queryKey : ["products"]},
            {queryKey : ["comments"]}
        ]
    })
    

    const [userQuery, productQuery, cocmmentQuery] = results;

    console.log("ë¡œë”©:",userQuery.isLoading);
 /*
    queryCache:
    â”œâ”€ ["users"]    â†’ ì‚¬ìš©ì ëª©ë¡ ìºì‹œ
    â”œâ”€ ["products"] â†’ ìƒí’ˆ ëª©ë¡ ìºì‹œ
    â””â”€ ["comments"] â†’ ëŒ“ê¸€ ëª©ë¡ ìºì‹œ
 */
  //ë¡œë”© ìƒíƒœ
  if(userIsLoading     ||
     productsIsLoading ||
     commentsIsLoding  ){
        return <p>ë°ì´í„° ê°€ì ¸ì˜¤ëŠ” ì¤‘!...</p>
  }

  // ì—ëŸ¬ ìƒíƒœ 
  if (userIsError     ||
      productsIsError ||
      commentsIsError  ){
        
        return <p>ğŸ’¥ ë°ì´í„° ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤!</p>
   }

  // const queryClient = useQueryClient();

  // const handleRefresh = ()=>{
  //   // products 
  //   //  ìºì‹œ ë¬´íš¨í™” +  ìë™ ìš”ì²­ 
  //   queryClient.invalidateQueries(["products"]);
  // }

  /*
  ì‹¤í–‰ìˆœì„œ!
  ì‚¬ìš©ì í´ë¦­ â†’ invalidateQueries(["products"])
              â†“
  ["products"] ìºì‹œ ìƒíƒœ = stale(ì˜¤ë˜ë¨)
              â†“
  React Query: â€œìƒˆë¡œ ë¶ˆëŸ¬ì™€ì•¼ê² ë‹¤!â€
              â†“
  queryFn (axios ìš”ì²­) ë‹¤ì‹œ ì‹¤í–‰
              â†“
  ìµœì‹  ë°ì´í„° ìˆ˜ì‹  â†’ í™”ë©´ ìë™ ì—…ë°ì´íŠ¸

  ì‹¤ì œ ì‹¤ë¬´ì—ì„œì˜ íŒ¨í„´
   ìƒí’ˆ ë“±ë¡ -> ìˆ˜ì • -> ì‚­ì œí›„  ìµœì‹ ëª©ë¡ìœ¼ë¡œ ìë™ ê°±ì‹ 
   ëŒ“ê¸€ ì‘ì„±í›„  ìƒˆë¡œìš´ ëŒ“ê¸€ ì¦‰ì‹œ ë°˜ì˜
  */

  return (
    <div>
      <h3>API ì—¬ëŸ¬ê°œ í˜¸ì¶œ (React Query)</h3>
      {/* <button onClick={handleRefresh}>ìƒˆë¡œê³ ì¹¨</button> */}
      
      {/* ğŸ‘© ì‚¬ìš©ì */}
      <section>
        <h4>ğŸ‘© ì‚¬ìš©ì ëª©ë¡</h4>
        <ul>
            {users.map((u) => 
                <li key={u.id}>{u.username}</li>
            )}
        </ul>
      </section>

      {/* ğŸ›’ ìƒí’ˆ */}
      <section>
        <h4>ğŸ›’ ìƒí’ˆ ëª©ë¡</h4>
        <ul>{products.map((p) => <li key={p.id}>{p.title}</li>)}</ul>
      </section>

      {/* ğŸ’¬ ëŒ“ê¸€ */}
      <section>
        <h4>ğŸ’¬ ëŒ“ê¸€ ëª©ë¡</h4>
        <ul>{comments.map((c) => <li key={c.id}>{c.body}</li>)}</ul>
      </section>
    </div>
  )
}

/*
 useQuery ì˜ ì‹¤í–‰ ìˆœì„œ
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚          ReactQueryEx2 ì»´í¬ë„ŒíŠ¸ ì‹¤í–‰          â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  useQuery() 3ê°œ ë“±ë¡ (ë™ì‹œ ì‹¤í–‰) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚           â”‚           â”‚
            â”‚           â”‚           â”‚
            â–¼           â–¼           â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ useQuery(["users"]) â”‚ â”‚ useQuery(["products"]) â”‚ â”‚ useQuery(["comments"]) â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                     â”‚
      â”‚ (queryFn ì‹¤í–‰)       â”‚ (queryFn ì‹¤í–‰)       â”‚ (queryFn ì‹¤í–‰)
      â–¼                     â–¼                     â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ axios ìš”ì²­ ì „ì†¡      â”‚ â”‚ axios ìš”ì²­ ì „ì†¡      â”‚ â”‚ axios ìš”ì²­ ì „ì†¡      â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                     â”‚
      â–¼                     â–¼                     â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ ì‘ë‹µ ìˆ˜ì‹  ì™„ë£Œ       â”‚ â”‚ ì‘ë‹µ ìˆ˜ì‹  ì™„ë£Œ       â”‚ â”‚ ì‘ë‹µ ìˆ˜ì‹  ì™„ë£Œ       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                     â”‚
      â–¼                     â–¼                     â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ ìºì‹œ ì €ì¥: ["users"] â”‚ â”‚ ìºì‹œ ì €ì¥: ["products"] â”‚ â”‚ ìºì‹œ ì €ì¥: ["comments"] â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                     â”‚                     â”‚
      â–¼                     â–¼                     â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚      React Query ìë™ ìƒíƒœ ì—…ë°ì´íŠ¸         â”‚
 â”‚      (isLoading â†’ false, data ì±„ì›Œì§)      â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚         ì»´í¬ë„ŒíŠ¸ ìë™ ë¦¬ë Œë”ë§(í™”ë©´ë‹¤ì‹œê·¸ë¦¬ê¸°!) ë°œìƒâ”‚
 â”‚   users, products, comments ë°ì´í„° í‘œì‹œ     â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚  QueryCache ìœ ì§€ (5ë¶„ê°„ ì¬ìš”ì²­ ì—†ìŒ)        â”‚
 â”‚  ë™ì¼ queryKey ìš”ì²­ ì‹œ ìºì‹œ ì¦‰ì‹œ ë°˜í™˜       â”‚
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


*/